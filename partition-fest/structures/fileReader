type reader = { firstline : unit -> string,
                nextline  : unit -> string,
                curloc    : unit -> string * int }

exception EOF
fun fileReader (filename : string, fd) =
  let val lineNum = ref 0
      fun get () =
        case TextIO.inputLine fd
          of NONE      => raise EOF
           | SOME line => line before lineNum := !lineNum + 1
  in { firstline = get, nextline = get, curloc = 
                                        (fn () => (filename, !lineNum))}
  end

fun reader (fd) =
  let fun accum fd =
    case TextIO.inputLine fd
      of NONE => []
       | SOME line => line :: (accum fd)
  in accum fd
  end





